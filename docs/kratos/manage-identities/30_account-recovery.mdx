---
id: account-recovery
title: Initiate account recovery for a user
sidebar_label: Administrative account recovery
---

import Tabs from "@theme/Tabs"
import TabItem from "@theme/TabItem"
import CodeBlock from "@theme/CodeBlock"
import SelfHostedKratos from "@site/src/components/SelfHostedKratos"

You can initiate account recovery for identities using the admin API endpoints.

:::note

You can initiate account recovery for a user without a recovery address via the admin API, but if the recovery flow expires the
users can't re-initiate the flow by themselves.

:::

## One time codes

<Tabs
  defaultValue="curl"
  values={[
    {label: 'curl', value: 'curl'},
    {label: 'GoLang', value: 'go'},
    {label: 'Self-Hosted Ory Kratos', value: 'kratos'},
  ]}>
  <TabItem value="curl">

```shell
curl --request POST -sL \
  --header "Authorization: Bearer ory_pat_xRKLsFEOUFQFVBjd6o3FQDifaLYhabGd" \
  --header "Content-Type: application/json" \
  --request POST \
  --data '{
  "expires_in": "12h",
  "identity_id": "e01b5f2f-6afc-4194-8578-4cebcf69a4d5"
}' https://playground.projects.oryapis.com/admin/recovery/code
```

  </TabItem>
  <TabItem value="go">

```go
package main

import (
  "fmt"
  "github.com/ory/client-go/client"
  "github.com/ory/client-go/client/admin"
  "github.com/ory/client-go/models"
)

func main() {
  c := client.New(nil, &client.TransportConfig{
        Host: "https://playground.projects.oryapis.com",
        BasePath: "/",
        Schemes: []string{"http"},
    })

  res, err := c.Admin.CreateRecoveryLink(admin.NewCreateRecoveryLinkParams().WithBody(admin.CreateRecoveryLinkBody{
    IdentityID: models.UUID("the-uuid"),
  }))
  if err != nil {
    // ...
  }

  fmt.Printf("Use link: %s", *res.Payload.RecoveryLink)
}
```

  </TabItem>
 <TabItem value="kratos">
    <SelfHostedKratos />

And use it to create a recovery code:

```shell
curl --request POST -sL \
  --header "Content-Type: application/json" \
  --data '{
  "expires_in": "12h",
  "identity_id": "e01b5f2f-6afc-4194-8578-4cebcf69a4d5"
}' http://127.0.0.1:4434/recovery/code
```

  </TabItem>
</Tabs>

The response contains a `recovery_link` containing the flow ID and a `recovery_code` containing a random 8-digit code. The link
should be opened by the user which will open a recovery code form. The `recovery_code` should be entered by the user here.

Afterwards they can then connect to a social sign-in provider or set up a password:

```json
{
  "recovery_link": "https://playground.projects.oryapis.com/self-service/recovery?flow=81c55cec-76fd-4907-bddf-cc112e835698",
  "recovery_code": "76453943",
  "expires_at": "2022-10-25T03:09:37.60684766Z"
}
```

If the user fails to set up their credentials in time, another recovery link needs to be issued and the user needs to re-do the
flow.

It is currently not possible to send the recovery link directly to a user's email, this feature is tracked as
[#595](https://github.com/ory/kratos/issues/595).

For more detailed information and general guidelines on account recovery, take a look at the
[account recovery and password reset](../../kratos/account-recovery-password-reset.mdx) section.

## Magic links

To create the account recovery link, use:

<Tabs
  defaultValue="curl"
  values={[
    {label: 'curl', value: 'curl'},
    {label: 'Ory Cloud', value: 'cloud'},
    {label: 'Self-Hosted Ory Kratos', value: 'kratos'},
  ]}>
  <TabItem value="curl">

```shell
curl --request POST -sL \
  --header "Authorization: Bearer ory_pat_xRKLsFEOUFQFVBjd6o3FQDifaLYhabGd" \
  --header "Content-Type: application/json" \
  --request POST \
  --data '{
  "expires_in": "12h",
  "identity_id": "e01b5f2f-6afc-4194-8578-4cebcf69a4d5"
}' https://playground.projects.oryapis.com/admin/recovery/link
```

  </TabItem>
  <TabItem value="go">

```go
package main

import (
  "fmt"
  "github.com/ory/client-go/client"
  "github.com/ory/client-go/client/admin"
  "github.com/ory/client-go/models"
)

func main() {
  c := client.New(nil, &client.TransportConfig{
        Host: "https://playground.projects.oryapis.com",
        BasePath: "/",
        Schemes: []string{"http"},
    })

  res, err := c.Admin.CreateRecoveryLink(admin.NewCreateRecoveryLinkParams().WithBody(admin.CreateRecoveryLinkBody{
    IdentityID: models.UUID("the-uuid"),
  }))
  if err != nil {
    // ...
  }

  fmt.Printf("Use link: %s", *res.Payload.RecoveryLink)
}
```

  </TabItem>
  <TabItem value="kratos">
    <SelfHostedKratos />

And use it to create a recovery link:

```shell
curl --request POST -sL \
  --header "Content-Type: application/json" \
  --data '{
  "expires_in": "12h",
  "identity_id": "e01b5f2f-6afc-4194-8578-4cebcf69a4d5"
}' http://127.0.0.1:4434/recovery/code
```

  </TabItem>
</Tabs>

The response contains a `recovery_link` value containing the flow ID and a random token. This link should be opened by the user.
Afterwards they can then connect to a social sign-in provider or set up a password:

```json
{
  "recovery_link": "https://playground.projects.oryapis.com/self-service/recovery?flow=81c55cec-76fd-4907-bddf-cc112e835698&token=yM9nAZpPIjwccKh9qHRh8OfywZSRcr6q",
  "expires_at": "2022-02-25T03:09:37.60684766Z"
}
```

If the user fails to set up their credentials in time, another recovery link needs to be issued and the user needs to re-do the
flow.

It is currently not possible to send the recovery link directly to a user's email, this feature is tracked as
[#595](https://github.com/ory/kratos/issues/595).

For more detailed information and general guidelines on account recovery, take a look at the
[account recovery and password reset](../../kratos/account-recovery-password-reset.mdx) section.
