---
id: verify-email-account-activation
title: Email and phone verification and account activation
---

```mdx-code-block
import useBaseUrl from "@docusaurus/useBaseUrl"
import Mermaid from "@theme/Mermaid"
import ApiWarning from "@theme/ApiWarning"
import SelfServiceBrowserFlow from "@theme/SelfServiceBrowserFlow"
import SelfServiceSpaFlow from "@theme/SelfServiceSpaFlow"
import SelfServiceApiFlow from "@theme/SelfServiceApiFlow"

import CodeTabs from "@theme/Code/CodeTabs"
import {
  getFlowMethodLinkWithErrors,
  getFlowMethodLinkSuccess,
  getFlowMethodLinkInvalidChallenge,
  getFlowMethodLinkChallengeDone,
} from "./code/verification"
import RenderFlow from "@site/src/theme/Code/RenderFlow"

import DomainWarning from "@theme/DomainWarning"
import AjaxWarning from "@theme/AjaxWarning"
import Tabs from "@theme/Tabs"
import TabItem from "@theme/TabItem"
```

Ory allows users to verify the addresses of their account. This is important to prove that the user has access to the address they
used to create their account. If verification is enabled, Ory Identities starts the verification process automatically. A user can
also verify their address manually.

The verification flow is supported in both browsers and API clients.

## Configuration

```mdx-code-block
<Tabs groupId="oc-or-oss">
  <TabItem value="ocp" label="The Ory Network" default>
```

Account verification can be configured on the **Authentication** → **Email Verification** page in the
[Ory Console](https://console.ory.sh/guides).

```mdx-code-block
  </TabItem>
  <TabItem value="oss" label="Ory Identities">
```

To enable verification flows, make the following adjustments to your Ory Identities configuration:

```yaml title="config.yml"
selfservice:
  methods:
    code:
      enabled: true
      config:
        # Defines how long the verification or the recovery code is valid for (default 1h)
        lifespan: 15m

  flows:
    verification:
      use: code # Defines which method is used, one of 'code' or 'link'.
      enabled: true

      # Defines how long the verification flow (the UI interaction, not the link!)
      # is valid for (default 1h)
      lifespan: 15m
```

```mdx-code-block
  </TabItem>
</Tabs>
```

### Identity schema

To make an address verifiable, it must be marked as such in the
[identity schema](../../manage-identities/15_customize-identity-schema.mdx). In most cases this is the email address the user
provides when registering their account. Other fields inside the `traits` section are supported as well.

```diff
 {
   "$id": "https://schemas.ory.sh/presets/kratos/quickstart/email-password/identity.schema.json",
   "$schema": "http://json-schema.org/draft-07/schema#",
   "title": "Person",
   "type": "object",
   "properties": {
     "traits": {
       "type": "object",
       "properties": {
         "email": {
           "type": "string",
           "format": "email",
           "ory.sh/kratos": {
             "credentials": {
               "password": {
                 "identifier": true
               }
             },
+            "verification": {
+              "via": "email"
+            }
           }
         }
       }
       "additionalProperties": false
     }
   }
 }
```

### Email Templates

Ory Identities (Ory Kratos) comes with default email templates for verification flows.

You can quickly replace the defaults and customize the messages to match the look and feel of your solution. Read the
[custom email template documentation](../../emails-sms/05_custom-email-templates.mdx) to learn more.

:::note

When users attempt to initiate verification for unregistered addresses, the system sends a message to the email address that was
used in the attempt.

This prevents account enumeration attacks as explained in this
[blog post by Troy Hunt](https://www.troyhunt.com/website-enumeration-insanity-how-our-personal-data-is-leaked/).

:::

### Require a verified address for login

Depending on your use case, you might want to limit what a user without at least one verified address is able to do in your
application. Ory Identities supports requiring a verified address before the user can log into their account.

```mdx-code-block
<Tabs groupId="oc-or-oss">
  <TabItem value="ocp" label="The Ory Network" default>
```

Go to the **Authentication** → **Email Verification** page in the [Ory Console](https://console.ory.sh/guides) and enable **
Require Verified Address for Login**.

```mdx-code-block
  </TabItem>
  <TabItem value="oss" label="Ory Identities">
```

Adjust your Ory Identities (Ory Kratos) configuration as follows:

```diff
selfservice:
  flows:
    login:
+      after:
+        hooks:
+        - hook: require_verified_address
```

For more information see the [hooks configuration](../../hooks/01_configure-hooks.mdx) documentation.

```mdx-code-block
  </TabItem>
</Tabs>
```

:::note

Please be aware, that when requiring a verified address for login, a typo in the email address set by the user either during the
registration or when changing their email address, will make the login for that user impossible.

:::

## Choosing the right strategy

Ory supports two strategies for verifying your user's addresses.

```mdx-code-block
<Tabs>
  <TabItem value="code" label="One-time codes">
```

When using one-time codes to verify a user's address, Ory Identities sends out an email containing a 6-digit code. If the user has
access to the mailbox they can enter the code they received to verify their address.

Alternatively, the email also contains a link to the form that pre-fills the code if the user clicks on it. The user must still
submit the form for Ory Identities to actually mark the address as verified.

```mdx-code-block
  </TabItem>
  <TabItem value="oss" label="Magic Links">
```

When choosing to send magic links to verify a user's address, Ory Identities sends out an email containing a "magic link". If the
user has access to the mailbox of that account and clicks the link, Ory Identities marks that address as verified.

```mdx-code-block
  </TabItem>
</Tabs>
```

If the user completes the verification after the link or code expired, they are asked to re-enter their email address and are sent
a new email for verification.

### Comparison

"One-time codes" (`code`) is the default, preferred, and recommended strategy by Ory.

Ory supports magic links, but considers this strategy a legacy solution. Currently, the strategy is supported but should be
considered deprecated and is set to be removed in future releases.

Consider using the `code` strategy as it mitigates many of the drawbacks of magic links:

- Some email virus scanners open links in emails to scan them. This invalidates the magic link and may prevent users from
  recovering their account even if they have the access to the defined recovery address.
- Verification flows initialized by apps on mobile phones or smart devices don't work with magic links.
- Depending on the device settings, clicking a magic link can open a different browser than the one used to initialize the
  verification flow. This can confuse your users.

:::caution

When you change the verification strategy from `link` to `code` in an existing project, you might need to adjust your UI. Make
sure the flow works correctly with your UI implementation after changing the recovery strategy.

:::

## Code examples

The user interface for the account verification is a page in your solution that should render the actual form elements for the
user.

In contrast to other identity systems, Ory Identities (Ory Kratos) doesn't render this HTML directly. Instead, you need to
implement the HTML code in your solution, which gives you complete flexibility and customizability in your user interface flows
and designs. This part of your application then directly interfaces with Ory Identities through the API.

The API responds with a JSON document describing the form elements to render and actions the form should take upon submission,
cancellation, etc. The following shows examples for a few different languages and frameworks.

<RenderFlow flow="verification" />
