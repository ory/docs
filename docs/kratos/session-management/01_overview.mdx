---
id: overview
title: Overview of sessions, session cookies, and session tokens in Ory
sidebar_label: Overview
---

# Overview

When an identity or end-user authenticates, for example by signing in with their username and password, they receive an Ory
Session. The session is proof that the user is authenticated and allows to interact with the system without the need to
authenticate again for every request.

Sessions can be issued in two formats:

- **Session cookie** - when the system detects that the interaction is done through a web browser, a cookie which represents the
  user's Session is stored in the browser.
- **Session token** - when the system detects a client other than a web browser, for example a native mobile app, a Session token
  is issued to the client.

:::note

For security reasons, you can't break the isolation between cookies and session tokens.

:::

## Ory Session

An example of an Ory session can be seen in the [Get session API](../../reference/api#tag/identity/operation/disableSession)
response.

| Property           | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :----------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `active`           | When set to `true`, the Ory Session is active and can be used to authenticate requests.                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `expires_at`       | Defines the time when the Session expires. This value depends on the session lifespan configuration.                                                                                                                                                                                                                                                                                                                                                                                                             |
| `authenticated_at` | Indicates the time of the most recent successful authentication. This value is updated when: <ul><li>The end-user authenticates with a second factor such as TOTP</li><li>The end-user refreshes their session using the [`/self-service/login/browser`](../../reference/api.mdx#operation/initializeSelfServiceLoginFlowForBrowsers) endpoint or [`/self-service/login/api`](../../reference/api.mdx#operation/initializeSelfServiceLoginFlowWithoutBrowser) endpoint and setting `refresh` to `true`</li></ul> |

### Using Ory Session Cookie

An Ory Session Cookie is issued when the user signs in through a web browser. To get the session payload, send a request to the
`/sessions/whoami` endpoint:

```mdx-code-block
import { getSdkUrl } from '@site/src/hooks'
import CodeBlock from '@theme/CodeBlock'

<CodeBlock language="shell">{`curl '${getSdkUrl().url}/sessions/whoami' \\
  -H 'Accept: application/json' \\
  -H 'Cookie: ory_kratos_session=MTYzNDIyNzEzN3xEdi1CQkFFQ180SUFBUkFCRUFBQVJfLUNBQUVHYzNSeWFXNW5EQThBRFhObGMzTnBiMjVmZEc5clpXNEdjM1J5YVc1bkRDSUFJRTFDYWtvME5VNVlaVWxvYVZWeWJrUnZhSEF4YmxSV2VVRlhNMWwxVlVGenxXpsk2cL21Dclk3nCoXV41N6bFxvVJSt7CeICy_815Aw=='`}</CodeBlock>
```

### Using Ory Session Token

An Ory Session Token is issued when the user authenticates through a client other than a web browser. To get the session payload,
send a request to the `/sessions/whoami` endpoint.

You must pass the token in one of two ways:

- In the `Authorization` HTTP header:

  ```mdx-code-block
  <CodeBlock language="shell">{`curl '${getSdkUrl().url}/sessions/whoami' \\
    -H 'Accept: application/json' \
    -H 'Authorization: Bearer BRFbGMzTnBiMjVmZEcEdjM1J5YVc1bkRDSUFvME5VNVlaVeWJrUnZhSEF4YmxSV2VVRlhNMWwxVlVGenxXpsk2cLXV41N6bFxvVJSt7CeICy'`}</CodeBlock>
  ```

- In the `X-Session-Token` HTTP header:

  ```mdx-code-block
  <CodeBlock language="shell">{`curl '${getSdkUrl().url}/sessions/whoami' \\
    -H 'Accept: application/json' \
    -H 'X-Session-Token: BRFbGMzTnBiMjVmZEcEdjM1J5YVc1bkRDSUFvME5VNVlaVeWJrUnZhSEF4YmxSV2VVRlhNMWwxVlVGenxXpsk2cLXV41N6bFxvVJSt7CeICy'`}</CodeBlock>
  ```

## Privileged Sessions

import { privilegedVideo } from "../../kratos/self-service/flows/code/settings"

To perform some profile changes, such as updating the email address, password, or adding/removing 2FA, the user must have a
privileged session.

:::tip

This flow is similar to [GitHub's sudo mode](https://help.github.com/en/github/authenticating-to-github/sudo-mode).

:::

The session is considered privileged when its `authenticated_at` isn't older than the `privileged_session_max_age` value defined
in the configuration.

### Configuration

This is how you update the `privileged_session_max_age` to `15m`:

````mdx-code-block
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
<TabItem value="console" label="Ory Console" default>

To change the privileged session duration, go to [**Ory Console**](https://console.ory.sh/) â†’ **Session Settings**, enter the desired value (Use hour (h), minute (m), second (s) to define interval, for example: 15m30s, 1m) in the Privileged Sessions section and click the **Save** button.

For example, to set the privileged session duration to 15 minutes, enter `15m`.

  </TabItem>
  <TabItem value="cloud" label="Ory CLI">
1. Download the Ory Identities config from your project and save it to a file:

```shell
## List all available projects
ory list projects

## Get config
ory get identity-config {project-id} --format yaml > identity-config.yaml
```

2. Update the configuration value for privileged session max age property (`privileged_session_max_age`) to the desired value (Use hour (h), minute (m), second (s) to define interval, for example: 15m30s, 1m).

```yaml title="config.yml"
selfservice:
  flows:
    settings:
      after:
        hooks: []
        password:
          hooks: []
        profile:
          hooks: []
      ui_url: /ui/settings
      // highlight-start
      privileged_session_max_age: 15m
      // highlight-end
      required_aal: highest_available
```

3. Update the Ory Identities configuration using the file you worked with:

```shell
 ory update identity-config {project-id} --file identity-config.yaml
```

  </TabItem>
</Tabs>
````

With this configuration in place, the user can perform the actions that require a privileged session up to 15 minutes after
signing in. When this time passes, the user must re-authenticate to access these options.

### Demo

Watch this video to see the flow in action:

<video controls width="100%">
  <source src={privilegedVideo.webm} type="video/webm" />
  <source src={privilegedVideo.mp4} type="video/mp4" />
  Sorry, your browser doesn't support embedded videos.
</video>

## Refreshing sessions

You can prompt the user to re-authenticate by interacting with the
[`/self-service/login/browser`](../../reference/api.mdx#operation/initializeSelfServiceLoginFlowForBrowsers) or
[`/self-service/login/api`](../../reference/api.mdx#operation/initializeSelfServiceLoginFlowWithoutBrowser) API and setting the
`refresh` parameter to true. Once the user has re-authenticated, the `authenticated_at` timestamp of the Ory Session will be set
to the current time.

```mdx-code-block
<CodeBlock language="shell">{`${getSdkUrl().url}/self-service/login/browser?refresh=true`}</CodeBlock>
```

If enabled, you can also refresh the second factor by setting both `refresh` and `aal`:

```mdx-code-block
<CodeBlock language="shell">{`${getSdkUrl().url}/self-service/login/browser?refresh=true&aal=aal2`}</CodeBlock>
```

## JSON Web Token (JWT) support

:::warning

Ory doesn't issue Sessions as JSON Web Tokens (JWTs).

:::

Sessions are not issued as JWTs for two main reasons:

1. Ory Sessions can end at any point in time, indicating that the user is no longer signed in. With JWTs it would not easily be
   possible to determine whether a session is still valid before the token expires.
2. Ory Sessions can be updated and changed at any point in time (for example when the user updates their profile), which can't be
   easily reflected in a JWT before it is refreshed.

We are taking many steps to reduce the latency of `toSession` / `/sessions/whoami` endpoints across the globe for Ory Network, so
that latency is not an issue for users.

However, if you don't want to make repeated calls to `toSession` / `/sessions/whoami`, or you need to use JWTs in your setup, you
can convert Ory Sessions to JWTs on your entry point. There, you could add caching to further reduce the amount of API calls made.

:::tip

[Ory Oathkeeper](https://www.ory.sh/oathkeeper) is an API Gateway capable of converting Ory Sessions to JWTs.

:::

```mdx-code-block
import Mermaid from '@theme/Mermaid';

<Mermaid chart={`
sequenceDiagram
	actor C as HTTP Client
    participant G as API Gateway
    participant O as Ory APIs
    participant S1 as API Server
    participant S2 as Other Service
    C->>+G:ory_session=...
    G->>+O:|GET /sessions/whoami
    O->>-G:id=... identity.id=...
    G->>G:Convert Session to JSON Web Token
    G->>+S1:Authorization: Bearer jwt...
    S1->>+S2:Authorization: Bearer jwt...
`}/>
```
