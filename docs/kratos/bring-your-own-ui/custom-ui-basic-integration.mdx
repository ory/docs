---
id: custom-ui-basic-integration
title: Basic Integration
sidebar_label: Basic Integration
sidebar_position: 2
toc_max_heading_level: 4
---

```mdx-code-block
import Tabs from "@theme/Tabs"
import TabItem from "@theme/TabItem"
import CodeBlock from "@theme/CodeBlock"
```

Ory provides headless APIs for ease of integration. This ensures that Ory is compatible with many software stacks across different
programming languages.

This document's focus is to provide the necessary fundamentals to get started with custom user interface integration. This
document does not cover integrating Social Sign In, Passwordless and Two-Factor Authentication, this will be covered in the
[Advanced Integration](./custom-ui-advanced-integration) document.

## The Ory Flow

Flows are the fundamental of Ory's self-service APIs and are used to accomplish a variety of goals, such as `login`,
`registration`, `settings`, `verification`, `recovery` and `logout`.

The self-service flows are standardized so that it follows the same steps regardless of which flow is integrated. The API is also
seperated into two types of applications - **browser and native**. The difference between the two application types are to set the
necessary security measures. For example in browser applications, the API will set a CSRF cookie while in native applications no
CSRF cookie is necessary.

A general overview of the flow can be summed up in five steps:

1. Create the flow with the appropriate purpose (e.g. login, registration, etc.) and application type (e.g. browser or native)
2. Use the flow data to render the UI.
3. Submit the flow with user data. (e.g. username and password)
4. Potentially handle errors like invalid user input by going back to step 2.
5. Handle the successful submission.

[![Flow overview](https://mermaid.ink/img/pako:eNpNkMFqwzAMhl9F-LRBS-45bDRJOwo7JfSU9CBstQkktmfLGyPJu891c5hOgu_74ZdmIY0ikYu7Q9vDZ91piHN4OVg7DhJ5MPoV9vs3KNrSETJlH8RwGs0PKGS8Pv0iKWVbk1bkgHuCy3ljZWJVm118RKSZnE_ZbBOqh7DU9BXIM6BWUEUK3zgOKhVY4DifPbjNSOB9fYaPKdwEKcn7BU5t08dq1hkmyaTA4p2u_9Wjc8YtUIidmMhNOKh4_fwwOhF7T9SJPK6KbhhG7kSn16hiYNP8ailydoF2IthYjaoB498mkd9w9LT-AWnNa80?type=png)](https://mermaid.live/edit#pako:eNpNkMFqwzAMhl9F-LRBS-45bDRJOwo7JfSU9CBstQkktmfLGyPJu891c5hOgu_74ZdmIY0ikYu7Q9vDZ91piHN4OVg7DhJ5MPoV9vs3KNrSETJlH8RwGs0PKGS8Pv0iKWVbk1bkgHuCy3ljZWJVm118RKSZnE_ZbBOqh7DU9BXIM6BWUEUK3zgOKhVY4DifPbjNSOB9fYaPKdwEKcn7BU5t08dq1hkmyaTA4p2u_9Wjc8YtUIidmMhNOKh4_fwwOhF7T9SJPK6KbhhG7kSn16hiYNP8ailydoF2IthYjaoB498mkd9w9LT-AWnNa80)

Furthermore, a flow can also consist of multiple `methods`, for example the `login` flow can have the `password` and `oidc`
method, however, only one `method` can be used at a time to complete the flow. The `methods` can also be customized through
project configuration, for example the `password` flow can be disabled and the `webauthn` method enabled or both can be enabled at
the same time to allow users to choose the `method` they which to use. This makes Ory very flexible and can be used for a variety
of use cases.

Below is a table mapping the `methods` according to their respective flow.

| Flow           | Methods                                                            |
| -------------- | ------------------------------------------------------------------ |
| `login`        | `password`, `oidc`, `totp`, `webauthn`, `lookup_secret`            |
| `registration` | `password`, `oidc`, `webauthn`                                     |
| `settings`     | `profile`, `password`, `oidc`, `lookup_secret`, `webauthn`, `totp` |
| `recovery`     | `link`, `code`                                                     |
| `verification` | `link`, `code`                                                     |

## Application Types

To understand which API endpoints to use, it is important to understand the difference between browser and native applications.

**Browser applications** are applications that the user interacts with inside the browser. This is true for Server-Side rendered
(SSR) and Single-Page applications (SPA). Since the application is rendered in the browser, the request between the user and Ory
needs to be secured. This is done by setting a CSRF cookie and token.

**Native applications** are all other applications that are not rendered in the browser. For example an Android application or
Desktop application. Since the application is not rendered in the browser, the CSRF cookie and token are not necessary.

That is why it is important to use the correct API endpoints for the correct application type.

## Create a flow

Before any data can be sent to Ory, a flow must be initialized. When a flow is created it will use the current project
configuration and return a flow object which can be used to render the UI. Additional security measures are also applied to the
flow to secure subsequent requests to Ory.

A flow can be created through a GET request to the
[`/self-service/<login|registration|settings|recovery|verification|logout>/<browser|api>`](../../reference/api#tag/frontend)
endpoint.

``````mdx-code-block
<Tabs groupId="create-flow-examples">

<TabItem value="curl-browser" label="cUrl (Browser flow)" default>

To ensure the requests work correctly for the browser flow, we can use the `-c` flag to store the cookies in a file.
On subsequent requests, we can use the `-b` flag to read the cookies from the file.

```mdx-code-block
import createExampleLoginCurlBrowser from '!!raw-loader!../../../code-examples/curl/login/create-login-browser.sh'

<CodeBlock language="shell" title="create-login-browser.sh">{createExampleLoginCurlBrowser}</CodeBlock>
```

</TabItem>

<TabItem value="curl-native" label="cUrl (Native flow)">

```mdx-code-block
import createExampleLoginCurlNative from '!!raw-loader!../../../code-examples/curl/login/create-login-api.sh'

<CodeBlock language="shell" title="create-login-api.sh">{createExampleLoginCurlNative}</CodeBlock>
```

</TabItem>


</Tabs>

### Server Side (Browser) Application

In browser applications that are rendered by the server (e.g. Go, PHP, Java, NodeJs, etc.) the flow can be initialized with a
redirect directly to Ory in the browser which in turn will redirect the browser back to the configured
[application URL](./configure-ory-to-use-your-ui) (e.g. `https://myapp.com/login?flow=<uuid>`).

```html
<form method="GET" action="https://{project.slug}.projects.oryapis.com/self-service/login/browser">
  <button type="submit">Login</button>
</form>
```

Since this is a browser based application, Ory will set cookies for CSRF protection as well as when a session is succesfully
created.

### Single Page Application (SPA)

Single Page Applications (SPA) can initialize the flow by calling the endpoint using AJAX or fetch instead of redirecting the
browser. The response will set the necessary cookies and contain all the UI nodes to render the form. For AJAX and fetch requests
to properly set the cookies, you must set the `withCredentials: true` in axios or `credentials: "include"` in fetch. In the event
that a flow is initialized through a browser redirect, the [application URL](./configure-ory-to-use-your-ui) needs to be set for
Ory to know about your application.

### Native Application

Native applications such as desktop and mobile must use the API flows which do not set any cookies. The response will contain all
the data used to render the UI. On successful login a session token is issued instead of a cookie and can be used to authenticate
subsequent requests to Ory.

## Fetching an existing flow

In cases where the flow already exists, we can retrieve the flow data using the flow ID through a GET request to
[`/self-service/<login|registration|settings|verification|recovery>/flows?id=<flowID>`](../../reference/api#tag/frontend). This is
useful in cases where Ory has already initialized the flow and redirected to your application. In such a case, the flow ID can be
extracted from the URL `?flow=` query parameter.

Take note of the type of flow as it determines the endpoint used to retrieve the flow. For example, the `login` flow will only be
available at the [`/self-service/login/flows?id=<flowId>`](../reference/api#tag/frontend/operation/getLoginFlow) endpoint.

Below is an example of fetching an existing `login` flow.

`````mdx-code-block
<Tabs groupId="create-flow-examples">

<TabItem value="curl-browser" label="cUrl (Browser flow)" default>

To ensure the requests work correctly for the browser flow, we can use the `-c` flag to store the cookies in a file.
On subsequent requests, we can use the `-b` flag to read the cookies from the file.

```mdx-code-block
import getExampleLoginCurlBrowser from '!!raw-loader!../../../code-examples/curl/login/get-login-browser.sh'

<CodeBlock language="shell" title="get-login-browser.sh">{getExampleLoginCurlBrowser}</CodeBlock>
```

</TabItem>

<TabItem value="curl-native" label="cUrl (Native flow)">

```mdx-code-block
import getExampleLoginCurlNative from '!!raw-loader!../../../code-examples/curl/login/get-login-api.sh'

<CodeBlock language="shell" title="get-login-api.sh">{getExampleLoginCurlNative}</CodeBlock>
```

</TabItem>


</Tabs>

Here are some cases where the flow would already exist:

1. Ory has initialized the flow and redirects to the UI (e.g. `/login?flow=<uuidv4>`)
2. The request was completed by the user, however, an error occurred, and we need to retrieve the flow data to display the error
3. The UI has 'stored' the flow ID in the URL so that page refreshes can retrieve the already existing flow data

:::note

The flow ID has an expiration time, so it is important to check the response status code when retrieving the flow data using an
existing flow ID. It is up to your application to handle this error case and create a new flow.

:::

## Submitting a flow

The flow always has to be initialized before any user data (e.g. email and password) can be submitted. Depending on the
application type the submission will be handled differently, however, the request will always be a `POST` request to the
`/self-service/login/<browser|api>?flow=<uuid>` endpoint. The `flow` data will contain the correct URL to be used in the form
under the `flow.ui.action` key.

```json5
{
  ui: {
    action: "http://{project.slug}.projects.oryapis.com/self-service/login?flow=<uuid>",
    method: "POST",
  },
}
```

```html
<form action="{flow.ui.action}" method="{flow.ui.method}">...</form>
```

`````mdx-code-block
<Tabs groupId="create-flow-examples">

<TabItem value="curl-browser" label="cUrl (Browser flow)" default>

To ensure the requests work correctly for the browser flow, we can use the `-c` flag to store the cookies in a file.
On subsequent requests, we can use the `-b` flag to read the cookies from the file.

```mdx-code-block
import submitExampleLoginCurlBrowser from '!!raw-loader!../../../code-examples/curl/login/submit-login-browser.sh'

<CodeBlock language="shell" title="submit-login-browser.sh">{submitExampleLoginCurlBrowser}</CodeBlock>
```

</TabItem>

<TabItem value="curl-native" label="cUrl (Native flow)">

```mdx-code-block
import submitExampleLoginCurlNative from '!!raw-loader!../../../code-examples/curl/login/submit-login-api.sh'

<CodeBlock language="shell" title="submit-login-api.sh">{submitExampleLoginCurlNative}</CodeBlock>
```

</TabItem>


</Tabs>

### Server Side (Browser) Application

In server-side rendered browser applications the submission will be handled by a native form POST to the Ory project URL. For
example, the action for login would be a POST request to
`https://{project.slug}.projects.oryapis.com/self-service/login/browser?flow=<id>`.

### Single Page Application (SPA)

In client-side rendered browser applications such as SPAs the submission can be handled in the background through AJAX or fetch
using a POST request to the Ory project URL. For example, the action for login would be a POST request to
`https://{project.slug}.projects.oryapis.com/self-service/login/browser?flow=<id>`.

### Native Application

In native applications we can simply do a POST request to the Ory project URL. For example, the action for login would be a POST
request to `https://{project.slug}.projects.oryapis.com/self-service/login/api?flow=<id>`.

## Login flow

The login flow is used to authenticate users and consists of a multitude of `methods`, namely `password`, `oidc` and `webauthn`.
The login flow also manages Two-Factor-Authentication (2FA) through the `totp`, `webauthn` and `lookup_secrets` methods.

In this section we will only cover the `password` method since it is the easiest to get started with.

### Create Login flow

Below there are code examples to create a `login` flow and render the user interface (where applicable). When creating a `login`
flow for **browser applications** you must use the
[`/self-service/login/browser`](../../reference/api#tag/frontend/operation/createBrowserLoginFlow) endpoint. When creating a
`login` flow for **native applications** you must use the
[`/self-service/login/api`](../../reference/api#tag/frontend/operation/createNativeLoginFlow) endpoint.

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import createLoginApi from '!!raw-loader!../../../code-examples/sdk/go/selfservice/create-login.go'

<CodeBlock language="go" title="login.go">{createLoginApi}</CodeBlock>
```

</TabItem>
<TabItem value="typescript" label="TypeScript (Native)">

```mdx-code-block
import createTsLoginApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/login/create-login-native.ts'

<CodeBlock language="ts" title="login.ts">{createTsLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="expressjs" label="Express.js (Browser)">

```mdx-code-block
import loginExpress from '!!raw-loader!../../../code-examples/sdk/typescript/src/ui/login-express.ts'

<CodeBlock language="ts" title="index.ts">{loginExpress}</CodeBlock>
```

```mdx-code-block
import authLayoutExpress from '!!raw-loader!../../../code-examples/sdk/typescript/src/ui/auth.hbs'
import mainLayoutExpress from '!!raw-loader!../../../code-examples/sdk/typescript/src/ui/main.hbs'

<CodeBlock language="handlebars" title="main.hbs">{mainLayoutExpress}</CodeBlock>
<CodeBlock language="handlebars" title="auth.hbs">{authLayoutExpress}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

This is a small react example that uses the Ory SDK to create a `login` flow and render the user interface.
Take note that we use the `@ory/integrations` package as a helper to filter the flow data to only render the `password` method form fields.

```mdx-code-block
import createReactLoginApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/login/create-login-react.tsx'

<CodeBlock language="ts" title="login.tsx">{createReactLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="curl-browser" label="cUrl (Browser flow)">

To ensure the requests work correctly for the browser flow, we can use the `-c` flag to store the cookies in a file.
On subsequent requests, we can use the `-b` flag to read the cookies from the file.

```mdx-code-block
import createLoginCurlBrowser from '!!raw-loader!../../../code-examples/curl/login/create-login-browser.sh'
import createLoginCurlBrowserJson from '../../../code-examples/curl/login/create-login-browser.json'

<CodeBlock language="shell" title="create-login-browser.sh">{createLoginCurlBrowser}</CodeBlock>
<CodeBlock language="json5" title="create-login-browser.json">{JSON.stringify(createLoginCurlBrowserJson, null, 2)}</CodeBlock>
```

</TabItem>

<TabItem value="curl-native" label="cUrl (Native flow)">

```mdx-code-block
import createLoginCurlNative from '!!raw-loader!../../../code-examples/curl/login/create-login-api.sh'
import createLoginCurlNativeJson from '../../../code-examples/curl/login/create-login-api.json'

<CodeBlock language="shell" title="create-login-api.sh">{createLoginCurlNative}</CodeBlock>
<CodeBlock language="json5" title="create-login-api.sh">{JSON.stringify(createLoginCurlNativeJson, null, 2)}</CodeBlock>
```

</TabItem>

</Tabs>
``````

### Get Login flow

When a flow already exists, we can retrieve it through a GET request to the
[`/self-service/login/flows?id=<flow-id>`](../../reference/api#tag/frontend/operation/getLoginFlow) endpoint using the flow ID.
Usually the flow ID is stored in the URL query parameter `?flow=` in your application. Below is an example of how to retrieve the
flow data using the flow ID.

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import getLoginApi from '!!raw-loader!../../../code-examples/sdk/go/selfservice/get-login.go'

<CodeBlock language="go" title="login.go">{getLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import getTsLoginApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/login/get-login-native.ts'

<CodeBlock language="ts" title="login.ts">{getTsLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

This is a small react example that uses the Ory SDK to retrieve the `login` flow and render the user interface.
Take note that we use the `@ory/integrations` package as a helper to filter the flow data to only render the `password` method form fields.

```mdx-code-block
import getReactLoginApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/login/get-login-react.tsx'

<CodeBlock language="ts" title="login.tsx">{getReactLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="curl-browser" label="cUrl (Browser flow)">

To ensure the requests work correctly for the browser flow, we can use the `-c` flag to store the cookies in a file.
On subsequent requests, we can use the `-b` flag to read the cookies from the file.

```mdx-code-block
import getLoginCurlBrowser from '!!raw-loader!../../../code-examples/curl/login/get-login-browser.sh'
import getLoginCurlBrowserJson from '../../../code-examples/curl/login/get-login-browser.json'

<CodeBlock language="shell" title="get-login-browser.sh">{getLoginCurlBrowser}</CodeBlock>
<CodeBlock language="json5" title="get-login-browser.json">{JSON.stringify(getLoginCurlBrowserJson, null, 2)}</CodeBlock>
```

</TabItem>

<TabItem value="curl-native" label="cUrl (Native flow)">

```mdx-code-block
import getLoginCurlNative from '!!raw-loader!../../../code-examples/curl/login/get-login-api.sh'
import getLoginCurlNativeJson from '../../../code-examples/curl/login/get-login-api.json'

<CodeBlock language="shell" title="get-login-api.sh">{getLoginCurlNative}</CodeBlock>
<CodeBlock language="json5" title="get-login-api.sh">{JSON.stringify(getLoginCurlNativeJson, null, 2)}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Submit Login flow

The last step is to submit the login flow with the user's credentials. This is done through a POST request to the Ory
[`/self-service/login`](../../reference/api#tag/frontend/operation/updateLoginFlow) endpoint.

For browser applications you need to ensure that all cookies are included in the request and that the CSRF token is sent in the
body of the request. The CSRF token value is a hidden input field called `csrf_token`.

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import submitLoginApi from '!!raw-loader!../../../code-examples/sdk/go/selfservice/submit-login.go'

<CodeBlock language="go" title="login.go">{submitLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import submitTsLoginApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/login/submit-login-native.ts'

<CodeBlock language="ts" title="login.ts">{submitTsLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import submitReactLoginApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/login/submit-login-react.tsx'

<CodeBlock language="tsx" title="login.tsx">{submitReactLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="curl-browser" label="cUrl (Browser flow)">

To ensure the requests work correctly for the browser flow, we can use the `-c` flag to store the cookies in a file.
On subsequent requests, we can use the `-b` flag to read the cookies from the file.

```mdx-code-block
import submitLoginCurlBrowser from '!!raw-loader!../../../code-examples/curl/login/submit-login-browser.sh'
import submitLoginCurlBrowserJson from '../../../code-examples/curl/login/submit-login-browser.json'

<CodeBlock language="shell" title="submit-login-browser.sh">{submitLoginCurlBrowser}</CodeBlock>
<CodeBlock language="json5" title="submit-login-browser.json">{JSON.stringify(getLoginCurlBrowserJson, null, 2)}</CodeBlock>
```

</TabItem>

<TabItem value="curl-native" label="cUrl (Native flow)">

```mdx-code-block
import submitLoginCurlNativeJson from '../../../code-examples/curl/login/submit-login-api.json'

<CodeBlock language="shell" title="submit-login-api.sh">{getLoginCurlNative}</CodeBlock>
<CodeBlock language="json5" title="submit-login-api.sh">{JSON.stringify(getLoginCurlNativeJson, null, 2)}</CodeBlock>
```

</TabItem>

</Tabs>
````

### More Concepts and API References

More conceptual information on the login flow can be found in [Self-service Login Flow](../self-service/flows/user-login).

For API references, please take a look at the [API Reference](../reference/api) section.

Below are the API references for the login flow.

- [Create Browser Login Flow](../reference/api#tag/frontend/operation/createBrowserLoginFlow)
- [Create Native Login Flow](../reference/api#tag/frontend/operation/createNativeLoginFlow)
- [Get Login Flow](../reference/api#tag/frontend/operation/getLoginFlow)
- [Update Login Flow](../reference/api#tag/frontend/operation/updateLoginFlow)

## Registration flow

The registration flow is used to by your users to register themselves within your application. This flow is highly flexible and
allows you to define custom fields and validation rules through your [Identity Schema](../manage-identities/identity-schema). This
flow also consists of a number of `methods` such as `password`, `oidc` and `webauthn`.

In this section, we will only focus on the `password` method since it is the easiest to get started with.

### Create Registration flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import createRegistrationApi from '!!raw-loader!../../../code-examples/sdk/go/selfservice/create-registration.go'

<CodeBlock language="go" title="registration.go">{createRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import createTsRegistrationApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/registration/create-registration-native.ts'

<CodeBlock language="ts" title="registration.ts">{createTsRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="expressjs" label="Express.js (Browser)">

```mdx-code-block
import registrationExpress from '!!raw-loader!../../../code-examples/sdk/typescript/src/ui/registration-express.ts'

<CodeBlock language="ts" title="index.ts">{registrationExpress}</CodeBlock>
```

```mdx-code-block
<CodeBlock language="handlebars" title="main.hbs">{mainLayoutExpress}</CodeBlock>
<CodeBlock language="handlebars" title="auth.hbs">{authLayoutExpress}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import createReactRegistrationApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/registration/create-registration-react.tsx'

<CodeBlock language="tsx" title="registration.tsx">{createReactRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="curl-browser" label="cUrl (Browser flow)">

To ensure the requests work correctly for the browser flow, we can use the `-c` flag to store the cookies in a file.
On subsequent requests, we can use the `-b` flag to read the cookies from the file.

```mdx-code-block
import createRegistrationCurlBrowser from '!!raw-loader!../../../code-examples/curl/registration/create-registration-browser.sh'
import createRegistrationCurlBrowserJson from '../../../code-examples/curl/registration/create-registration-browser.json'

<CodeBlock language="shell" title="create-registration-browser.sh">{createRegistrationCurlBrowser}</CodeBlock>
<CodeBlock language="json5" title="create-registration-browser.json">{JSON.stringify(createRegistrationCurlBrowserJson, null, 2)}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Get Registration flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import getRegistrationApi from '!!raw-loader!../../../code-examples/sdk/go/selfservice/get-registration.go'

<CodeBlock language="go" title="registration.go">{getRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import getTsRegistrationApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/registration/get-registration-native.ts'

<CodeBlock language="ts" title="registration.ts">{getTsRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import getReactRegistrationApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/registration/get-registration-react.tsx'

<CodeBlock language="tsx" title="registration.tsx">{getReactRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="curl-browser" label="cUrl (Browser flow)">

To ensure the requests work correctly for the browser flow, we can use the `-c` flag to store the cookies in a file.
On subsequent requests, we can use the `-b` flag to read the cookies from the file.

```mdx-code-block
import getRegistrationCurlBrowser from '!!raw-loader!../../../code-examples/curl/registration/get-registration-browser.sh'
import getRegistrationCurlBrowserJson from '../../../code-examples/curl/registration/get-registration-browser.json'

<CodeBlock language="shell" title="create-registration-browser.sh">{getRegistrationCurlBrowser}</CodeBlock>
<CodeBlock language="json5" title="create-registration-browser.json">{JSON.stringify(getRegistrationCurlBrowserJson, null, 2)}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Submit Registration flow

The registration payload is fully dependent on your Identity Schema. Take note of the `flow.ui.nodes` property in the response
payload when creating or getting the registration flow. This property contains the registration form fields that you need to
provide in the request payload. To learn more about customizing your Identity Schema please refer to
[Identity model](../manage-identities/overview) documentation.

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import submitRegistrationApi from '!!raw-loader!../../../code-examples/sdk/go/selfservice/submit-registration.go'

<CodeBlock language="go" title="registration.go">{submitRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import submitTsRegistrationApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/registration/submit-registration-native.ts'

<CodeBlock language="ts" title="registration.ts">{submitTsRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import submitReactRegistrationApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/registration/submit-registration-react.tsx'

<CodeBlock language="tsx" title="registration.tsx">{submitReactRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="curl-browser" label="cUrl (Browser flow)">

To ensure the requests work correctly for the browser flow, we can use the `-c` flag to store the cookies in a file.
On subsequent requests, we can use the `-b` flag to read the cookies from the file.

Take note of the payload, in this example we have two required traits, `traits.email` and `traits.tos` which is based on the Identity Schema.

```mdx-code-block
import submitRegistrationCurlBrowser from '!!raw-loader!../../../code-examples/curl/registration/submit-registration-browser.sh'
import submitRegistrationCurlBrowserJson from '../../../code-examples/curl/registration/submit-registration-browser.json'

<CodeBlock language="shell" title="submit-registration-browser.sh">{submitRegistrationCurlBrowser}</CodeBlock>
<CodeBlock language="json5" title="submit-registration-browser.json">{JSON.stringify(submitRegistrationCurlBrowserJson, null, 2)}</CodeBlock>
```

</TabItem>

</Tabs>
````

### More Concepts and API References

More conceptual information on the registration flow can be found in
[Self-service Registration Flow](../self-service/flows/user-registration).

For API references, please take a look at the [API Reference](../reference/api) section.

Below are the API references for the registration flow.

- [Create Browser Registration Flow](../reference/api#tag/frontend/operation/createBrowserRegistrationFlow)
- [Create Native Registration Flow](../reference/api#tag/frontend/operation/createNativeRegistrationFlow)
- [Get Registration Flow](../reference/api#tag/frontend/operation/getRegistrationFlow)
- [Update Registration Flow](../reference/api#tag/frontend/operation/updateRegistrationFlow)

## Recovery

Recovery flows are used to recover user credentials. The recovery flow has two methods, `link` and `code` which determines how the
recovery flow is completed. The `link` method sends a recovery link and `code` sends a recovery code to the user's email address.

:::note

The `code` method is preferred to the `link` method to prevent the recovery flow from being invalidated by email clients and spam
filters.

:::

### Create Recovery flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import createRecoveryApi from '!!raw-loader!../../../code-examples/sdk/go/selfservice/create-recovery.go'

<CodeBlock language="go" title="recovery.go">{createRecoveryApi}</CodeBlock>
```

</TabItem>

<TabItem value="expressjs" label="Express.js (Browser)">

```mdx-code-block
import recoveryExpress from '!!raw-loader!../../../code-examples/sdk/typescript/src/ui/recovery-express.ts'

<CodeBlock language="ts" title="index.ts">{recoveryExpress}</CodeBlock>
```

```mdx-code-block
<CodeBlock language="handlebars" title="main.hbs">{mainLayoutExpress}</CodeBlock>
<CodeBlock language="handlebars" title="auth.hbs">{authLayoutExpress}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import createTsRecoveryApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/recovery/create-recovery-native.ts'

<CodeBlock language="ts" title="recovery.ts">{createTsRecoveryApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import createReactRecoveryApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/recovery/create-recovery-react.tsx'

<CodeBlock language="tsx" title="recovery.tsx">{createReactRecoveryApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Get Recovery flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import getRecoveryApi from '!!raw-loader!../../../code-examples/sdk/go/selfservice/get-recovery.go'

<CodeBlock language="go" title="recovery.go">{getRecoveryApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import getTsRecoveryApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/recovery/get-recovery-native.ts'

<CodeBlock language="ts" title="recovery.ts">{getTsRecoveryApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import getReactRecoveryApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/recovery/get-recovery-react.tsx'

<CodeBlock language="tsx" title="recovery.tsx">{getReactRecoveryApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Submit Recovery flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import submitRecoveryApi from '!!raw-loader!../../../code-examples/sdk/go/selfservice/submit-recovery.go'

<CodeBlock language="go" title="recovery.go">{submitRecoveryApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import submitTsRecoveryApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/recovery/submit-recovery-native.ts'

<CodeBlock language="ts" title="recovery.ts">{submitTsRecoveryApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import submitReactRecoveryApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/recovery/submit-recovery-react.tsx'

<CodeBlock language="tsx" title="recovery.tsx">{submitReactRecoveryApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### More Concepts and API References

More conceptual information on the recovery flow can be found in
[Account recovery and password reset](../self-service/flows/account-recovery-password-reset).

For API references, please take a look at the [API Reference](../reference/api) section.

Below are the API references for the recovery flow.

- [Create Browser Recovery Flow](../reference/api#tag/frontend/operation/createBrowserRecoveryFlow)
- [Create Native Recovery Flow](../reference/api#tag/frontend/operation/createNativeRecoveryFlow)
- [Get Recovery Flow](../reference/api#tag/frontend/operation/getRecoveryFlow)
- [Update Recovery Flow](../reference/api#tag/frontend/operation/updateRecoveryFlow)

## Verification flow

Verification flows are used to verify user email addresses. When the verification is successful, the request will respond with a
`200 OK` HTTP status code. When the request fails, it responds with the appropriate HTTP status and error messages.

:::note

To use the verification flow, you might need to enable it. Please take a look at
[Email verification](../self-service/flows/verify-email-account-activation)

:::

### Create Verification flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import createVerificaitonApi from '!!raw-loader!../../../code-examples/sdk/go/selfservice/create-verification.go'

<CodeBlock language="go" title="verification.go">{createVerificaitonApi}</CodeBlock>
```

</TabItem>

<TabItem value="expressjs" label="Express.js (Browser)">

```mdx-code-block
import verificationExpress from '!!raw-loader!../../../code-examples/sdk/typescript/src/ui/verification-express.ts'

<CodeBlock language="ts" title="index.ts">{verificationExpress}</CodeBlock>
```

```mdx-code-block
<CodeBlock language="handlebars" title="main.hbs">{mainLayoutExpress}</CodeBlock>
<CodeBlock language="handlebars" title="auth.hbs">{authLayoutExpress}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import createTsVerificationApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/verification/create-verification-native.ts'

<CodeBlock language="ts" title="verification.ts">{createTsVerificationApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import createReactVerificationApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/verification/create-verification-react.tsx'

<CodeBlock language="tsx" title="verification.tsx">{createReactVerificationApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Get Verification flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import getVerificaitonApi from '!!raw-loader!../../../code-examples/sdk/go/selfservice/get-verification.go'

<CodeBlock language="go" title="verification.go">{getVerificaitonApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import getTsVerificationApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/verification/get-verification-native.ts'

<CodeBlock language="ts" title="verification.ts">{getTsVerificationApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import getReactVerificationApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/verification/get-verification-react.tsx'

<CodeBlock language="tsx" title="verification.tsx">{getReactVerificationApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Submit Verification flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import submitVerificationApi from '!!raw-loader!../../../code-examples/sdk/go/selfservice/submit-verification.go'

<CodeBlock language="go" title="verification.go">{submitVerificationApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import submitTsVerificationApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/verification/submit-verification-native.ts'

<CodeBlock language="ts" title="verification.ts">{submitTsVerificationApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import submitReactVerificationApi from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/verification/submit-verification-react.tsx'

<CodeBlock language="tsx" title="verification.tsx">{submitReactVerificationApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### More Concepts and API References

More conceptual information on the verification flow can be found in
[Verify email account activation](../self-service/flows/verify-email-account-activation).

For API references, please take a look at the [API Reference](../reference/api) section.

Below are the API references for the verification flow.

- [Create Browser Verification Flow](../reference/api#tag/frontend/operation/createBrowserVerificationFlow)
- [Create Native Verification Flow](../reference/api#tag/frontend/operation/createNativeVerificationFlow)
- [Get Verification Flow](../reference/api#tag/frontend/operation/getVerificationFlow)
- [Update Verification Flow](../reference/api#tag/frontend/operation/updateVerificationFlow)

## Logout flow

Depending on the application type (browser or native) the logout flow has a different behaviour. With a browser application, the
logout flow needs to be initialized to create a logout URL which is associated with the current session cookie. The application
can then call the logout URL through a redirect or a background AJAX request.

Note that in browser applications the application needs to do a GET request to initialize the logout URL by calling
[`/self-service/logout/browser`](../reference/api#tag/frontend/operation/createBrowserLogoutFlow) and a GET to complete the logout
[/self-service/logout](../reference/api#tag/frontend/operation/updateLogoutFlow) flow.

In native applications the application does not need to initialize the logout flow and only needs to do a DELETE request to the
[`/self-service/logout/api`](../reference/api#tag/frontend/operation/performNativeLogout) endpoint containing the session token in
the body.

```shell
curl -X DELETE -H "Content-Type: application/json" -d '{"session_token":"<session_token>"}' https://{project.}
```

## Session Checks

````mdx-code-block
<Tabs groupId="application-type-examples">

<TabItem value="server-browser" label="Server Side (browser)" default>

Below is an example of the SDK calling the [`/sessions/whoami`](../reference/api#tag/frontend/operation/toSession) endpoint in an Express.js middleware.

```mdx-code-block
import whoamiExpress from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/session/whoami-express.ts'

<CodeBlock language="ts" title="middleware.ts">{whoamiExpress}</CodeBlock>
```
</TabItem>

<TabItem value="client-browser" label="Client Side (SPA)">

```typescript
await fetch('https://localhost:4000/sessions/whoami', { // <-- your Ory CLI tunnel URL
  method: 'GET',
  // highlight-next-line
  credentials: 'include',
}).then((response) => response.json())
```

When using the Ory SDK you need to specify the `withCredentials: true` option in the SDK configuration. Below is an example of the
SDK calling the [`/sessions/whoami`](../reference/api#tag/frontend/operation/toSession) endpoint automatically including the
cookies in the request.

```mdx-code-block
import whoamiReact from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/session/whoami-react.tsx'

<CodeBlock language="tsx" title="session.tsx">{whoamiReact}</CodeBlock>
```

</TabItem>

<TabItem value="native" label="Native">

With the Ory SDK you can set the `withCredentials: false` option and use the session token in the `Authorization: Bearer <token>`
header. Below is an example of the SDK calling the [`/sessions/whoami`](../reference/api#tag/frontend/operation/toSession)
endpoint.

```mdx-code-block
import whoamiNative from '!!raw-loader!../../../code-examples/sdk/typescript/src/selfservice/session/whoami-native.ts'

<CodeBlock language="ts" title="session.ts">{whoamiNative}</CodeBlock>
```

</TabItem>

<TabItem value="curl-browser" label="cUrl (Browser flow)">

```mdx-code-block
import whoamiCurlBrowser from '!!raw-loader!../../../code-examples/curl/session/check-session-browser.sh'
import whoamiCurlBrowserJson from '../../../code-examples/curl/session/check-session-browser.json'

<CodeBlock language="shell" title="check-session-browser.sh">{whoamiCurlBrowser}</CodeBlock>
<CodeBlock language="json5" title="check-session-browser.json">{JSON.stringify(whoamiCurlBrowserJson, null, 2)}</CodeBlock>
```

</TabItem>

<TabItem value="curl-native" label="cUrl (Native flow)">

```mdx-code-block
import whoamiCurlNative from '!!raw-loader!../../../code-examples/curl/session/check-session-api.sh'
import whoamiCurlNativeJson from '../../../code-examples/curl/session/check-session-api.json'

<CodeBlock language="shell" title="create-login-api.sh">{whoamiCurlNative}</CodeBlock>
<CodeBlock language="json5" title="check-session-native.json">{JSON.stringify(whoamiCurlNativeJson, null, 2)}</CodeBlock>
```

</TabItem>

</Tabs>
````

## Error Handling

Ory provides errors at different levels of the flow:

1. Request level errors (e.g. the request expired)
2. Method level (e.g. login with password method)
3. Field level (e.g. password field)

Request level errors happen when the request has failed due to an invalid state. For example, the login flow is created, however,
the session already exists.

Method level errors happen when the method being requested fails.

Each level's error message structure is the same as shown below:

```json5
{
  id: 1234,
  // This ID will not change and can be used to translate the message or use your own message content.
  text: "Some default text",
  // A default text in english that you can display if you do not want to customize the message.
  context: {},
  // A JSON object which may contain additional fields such as `expires_at`. This is helpful if you want to craft your own messages.
}
```

Here is a Typescript example using the Ory SDK of each:

```ts
  // call the sdk
  // sdk...
  .then(({data: flow}) => {
    // error message can also exist inside the flow data even when the request is successful.
    // It is usually the case when we retrieved the login flow using the flow ID and the flow was submitted previously
    // but still contains errors.

    // method level error
    // messages is an array of error messages
    err.response?.data?.ui.messages.forEach((message) => {
      console.log(message)
    })

    // field level error
    err.response?.data?.ui.nodes.forEach(({ messages }) => {
      // messages is an array of error messages
      messages.forEach((message) => {
        console.log(message)
      })
    })
  })
  .catch((err: AxiosError) => {
    // if the request failed but the response is not only an error
    // it will contain flow data which can be used to display error messages
    // this is common when submitting a form (e.g. login or registration)
    // and getting a response status 400 `Bad Request` back.

    if (err.response.status === 400) {
      // method level error
      // messages is an array of error messages
      err.response?.data?.ui.messages.forEach((message) => {
        console.log(message)
      })

      // field level error
      err.response?.data?.ui.nodes.forEach(({ messages }) => {
        // messages is an array of error messages
        messages.forEach((message) => {
          console.log(message)
        })
      })
    } else {
      // request level error
      if (err.response?.data?.error) {
        console.log(err.response.data.error)
      }
    }
  })
```

## Debugging

### CORS errors

To solve Cross-Origin Resource Sharing (CORS) errors please make sure you are using the
[Ory CLI tunnel](../../getting-started/local-development) on local development and in production you should
[add your domain](../../guides/custom-domains) to the Ory Project so that all requests from your frontend can be made to Ory under
the same domain.

Ory has a deny by default policy which means that the `Access-Control-Allow-Origin` header is only set on domains we own.

To learn more about CORS please read the [Mozilla CORS documentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS).

### CSRF errors

Ory provides CSRF protection for all `flows`. This means that you need to send a CSRF token in the body and CSRF cookie back when
submitting a `flow`. The cookie should be sent by default by your browser, but you need to add the CSRF token manually to the body
of the request. This can be a JSON object or a native form POST.

When mapping UI nodes take note of input fields with the name `csrf_token` with the `hidden` attribute. An example of mapping the
UI nodes for csrf protection could look like this:

```mdx-code-block
import csrfMapping from '!!raw-loader!../../../code-examples/sdk/typescript/src/ui/csrf-mapping.tsx'

<CodeBlock language="tsx">{csrfMapping}</CodeBlock>
```
