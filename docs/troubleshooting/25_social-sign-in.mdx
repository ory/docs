---
id: troubleshooting-social-sign-in
title: Troubleshooting social sign-in integrations
sidebar_label: Social sign-in troubleshooting
---

## 'redirect_uri' mismatch

Ensure that the `redirect_uri` query parameter in the URL matches the authorized redirect URI added to the social provider.

```
https://{provider}/o/oauth2/v2/auth?client_id=(...)&
redirect_uri=https://{project.slug}.projects.oryapis.com/self-service/methods/oidc/callback/{provider}&
response_type=code&scope=email+profile+openid
```

:::info

This is also a known problem with projects created before September 2022 that use a custom domain. Please see
[Social sign-in `redirect_uri_mismatch` error](./oidc-redirect-url-cname-OTA-092022-01) for further information.

:::

## 'oryapis.com' doesn't work as authorized redirect URI

Integrating with a social provider may require you to prove your ownership of the authorized redirect URI domain. In this case,
the `https://{project.slug}.projects.oryapis.com` URL cannot be used as the redirect URI and only a custom domain can be used.

To configure Ory to add your domain to the `redirect_uri` query parameter when redirecting to the social provider, you need to
adjust your project OIDC `base_redirect_uri` configuration.

```shell
ory patch identity-config {project-id} --add '/selfservice/methods/oidc/config/base_redirect_uri="https://ory.your-custom-domain.com"'
```

Lastly, ensure that the custom domain is added to the social provider as an authorized redirect URI.

## Redirect loops after successful registration

Ory will redirect back to the registration page after a successful OIDC flow when some traits couldn't be mapped from the Social
Provider and require manual input from the user, for example a phone number.

However, when the Jsonnet configuration for the Social Provider is incorrect and cannot map the data correctly, no input fields
will be present and the registration page with be stuck in a redirect loop. To understand how to fix the problem, we will go
through how Ory handles the OIDC registration flow.

Ory does a total of 5 steps when a user registers via Social Sign-in:

1. Redirect to the social provider
2. Redirect back to Ory with a `code` query parameter
3. Ory exchanges the `code` for an access token and retrieves the user information
4. Ory maps the user information to the [Identity Schema traits](../kratos/manage-identities/identity-schema)
5. (optional) Ory redirects back to the registration page with the missing traits filled in

When step 4 fails, Ory will be stuck in a redirect loop as shown below. To fix the redirect loop, the Jsonnet configuration for
the Social Provider needs to be adjusted.

Ory relies on the Jsonnet configuration to map the retrieved information to the Identity Schema traits. Please take a look at
[Social Sign-in data mapping](../kratos/social-signin/data-mapping) for further information.
