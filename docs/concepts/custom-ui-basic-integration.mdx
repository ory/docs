---
id: custom-ui-basic-integration
title: Integration Basics
sidebar_label: Integration Basics
toc_max_heading_level: 4
---

```mdx-code-block
import Tabs from "@theme/Tabs"
import TabItem from "@theme/TabItem"
import CodeBlock from "@theme/CodeBlock"
```

Ory provides headless APIs for ease of integration. This ensures that Ory is compatible with many software stacks across different
programming languages.

This document's focus is to provide the necessary fundamentals to get started with custom UI integration. Flows are the
fundamental of Ory's self-service APIs and are used to accomplish a variety of goals, such as `login`, `registration`, `settings`,
`verification`, `recovery` and `logout`.

The self-service `flows` are standardized so that it follows the same steps regardless of which `flow` is integrated. The API is
also seperated into two types of applications - browser and native. The difference between the two application types are to set
the necessary security measures. For example in browser applications, the API will set a CSRF cookie while in native applications
no CSRF cookie is necessary.

A general overview of the flow can be summed up in five steps:

1. Create the `flow` with the appropriate purpose (e.g. login, registration, etc.) and application type (e.g. browser or native)
2. Use the flow data to render the UI.
3. Submit the flow with user data. (e.g. username and password)
4. Potentially handle errors like invalid user input by going back to step 2.
5. Handle the successful submission.

For more information on the `flow` concepts, take a look at the [Self-service flow](../kratos/self-service) documentation.

## Create a flow

The first step is to initialize a flow. This is done by calling the
[`/self-service/<login|registration|settings|recovery|verification|logout/<browser|api>`](../reference/api#tag/frontend) endpoint.

### Server Side (Browser)

In browser applications that are rendered by the server (e.g. Go, PHP, Java, NodeJs, etc.) the flow can be initialized with a
redirect directly to Ory in the browser which in turn will redirect the browser back to the configured
[application URL](./bring-your-user-interface) (e.g. `https://myapp.com/login?flow=<uuid>`).

```html
<form method="GET" action="https://<project-url>/self-service/login/browser">
  <button type="submit">Login</button>
</form>
```

Do note, however, that since this is a browser flow cookies are set which will need to be parsed on the server when making any
subsequent requests to Ory.

Here is an example in ExpressJS to include cookies on a session request to Ory:

```mdx-code-block
import whoamiServerSide from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/session/whoami-server.ts'

<CodeBlock language="ts">{whoamiServerSide}</CodeBlock>
```

### Single Page Applications (SPA)

Single Page Applications (SPA) can initialize the flow by calling the endpoint using AJAX or fetch instead of redirecting the
browser. In the event that a flow is initialized through a browser redirect, the
[application URL](../guides/bring-your-user-interface) needs to be set for Ory to know about your application. The response will
set any necessary cookies in the browser and contain all the data used to render the UI. For AJAX and fetch request to properly
set the cookies, you must set the `withCredentials: true` in axios or `credentials: "include"` in fetch.

When using the Ory SDK you need to specify the `withCredentials: true` option in the SDK configuration.

```ts
import { Configuration, FrontendApi } from "@ory/client"

export default new FrontendApi(
  new Configuration({
    basePath: process.env.ORY_SDK_URL, // usually your cname entry or local ory tunnel url
    // we always want to include the cookies in each request
    // cookies are used for sessions and CSRF protection
    baseOptions: {
      withCredentials: true,
    },
  }),
)
```

### Native applications

Native applications such as Desktop and Mobile applications must use the API flows which do not set any cookies, however, on a
successful session Ory provides a session token. The response will contain all the data used to render the UI. On successful login
the session token can be used to authenticate subsequent requests to Ory.

With the Ory SDK you can set the `withCredentials: false` option and use the session token in the `Authorization: Bearer <token>`
header.

```ts
import { Configuration, FrontendApi } from "@ory/client"

const frontend = new FrontendApi(
  new Configuration({
    basePath: process.env.ORY_SDK_URL,
    baseOptions: {
      withCredentials: false,
    },
  }),
)

frontend
  .toSession({ xSessionToken: token })
  .then(({ status, data: flow }) => {
    if (status === 200) {
      // we have a valid session
    }
  })
  .catch((err) => {
    // we have an invalid session
  })
```

## Fetching an existing flow

In cases where the flow already exists, we can retrieve the flow data using the flow ID. This is useful in cases where Ory has
already initialized the flow and redirected to the UI. In such a case, the flow ID can be extracted from the URL `?flow=` query
parameter.

Here are some cases where the flow would already exist:

1. Ory has initialized the flow and redirects to the UI (e.g. `/login?flow=<uuidv4>`)
2. The request was completed by the user, however, an error occurred, and we need to retrieve the flow data to display the error
3. The UI has 'stored' the flow ID in the URL so that page refreshes can retrieve the already existing flow data

:::note

The flow ID has an expiration time, so it is important to check the response status code when retrieving the flow data using an
existing flow ID. It is up to your application to handle this error case and create a new flow.

:::

## Submitting a flow

The flow always has to be initialized before any user data (e.g. email and password) can be submitted. Depending on the type of
application (e.g. browser or native) the initialized flow will set a CSRF cookie and return a CSRF token in the response body. It
is important in **browser based applications** to take note of the CSRF tokens since it is required when submitting the user data.

:::warning

Never use API flows to implement Browser applications! Using API flows in Single-Page-Apps as well as server-side apps opens up
several potential attack vectors, including Login and other CSRF attacks.

:::

## Login flow

Login flows are used to authenticate users. When the login is successful, the request will respond with a `200 OK` HTTP status
code and a JSON body containing the user's identity information. When the request fails, it responds with the appropriate HTTP
status and error messages.

### Create Login flow

In browser and native applications, additional options can be specified when creating a login flow such as `?refresh=true` and
`?aal=<level>`. For more information on these options, take a look at the [Self-service flow](../kratos/self-service)
documentation.

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import createLoginApi from '!!raw-loader!../../code-examples/sdk/go/selfservice/create-login.go'

<CodeBlock language="go">{createLoginApi}</CodeBlock>
````

</TabItem>
<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import createTsLoginApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/login/create-login-native.ts'

<CodeBlock language="ts">{createTsLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import createReactLoginApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/login/create-login-react.tsx'

<CodeBlock language="ts">{createReactLoginApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

#### Two-Factor authentication

Two-Factor authentication (2FA) is a second step to confirming the user's credentials with another credential, such as `TOTP` or
`TouchID`. When creating a login flow, you can specify the `?aal=<level>` query parameter to specify the level of authentication.

In Ory the levels are:

- aal1: Password or OIDC
- aal2: aal1 + TOTP or WebAuthn or Lookup Secrets

In the case of initializing a second factor, the user must already have a valid session cookie. The
[`/sessions/whoami`](../reference/api#tag/frontend/operation/toSession) endpoint will return with an error with an id
`session_aal2_required` if the user is required to complete a second factor. More information on UI error messages can be found on
the [Customize user interface](../kratos/concepts/ui-user-interface) page.

For more information on Multi-factor authentication take a look at the [Multi-factor authentication](../kratos/mfa/overview).

### Get Login flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import getLoginApi from '!!raw-loader!../../code-examples/sdk/go/selfservice/get-login.go'

<CodeBlock language="go">{getLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import getTsLoginApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/login/get-login-native.ts'

<CodeBlock language="ts">{getTsLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import getReactLoginApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/login/get-login-react.tsx'

<CodeBlock language="ts">{getReactLoginApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Submit Login flow

We can submit the login flow with user data (e.g. username and password) using the flow ID. Depending on the type of application
(e.g. browser or native) the CSRF tokens are required in the request body and cookie.

In some cases, such as submitting WebAuthn passwordless, the response code could be `422` which indicates that the browser needs
to be redirected with a newly created flow. In Single Page Applications (SPAs) instead of redirecting, the response can be decoded
and the new flow ID extracted.

:::note

A session cookie or token can also be prevented on login using additional checks, such as only allowing verified users to login.
For more information, please take a look at
[Customize login and registration](../identities/sign-in/actions#allow-login-only-with-verified-email)

:::

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import submitLoginApi from '!!raw-loader!../../code-examples/sdk/go/selfservice/submit-login.go'

<CodeBlock language="go">{submitLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import submitTsLoginApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/login/submit-login-native.ts'

<CodeBlock language="ts">{submitTsLoginApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import submitReactLoginApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/login/submit-login-react.tsx'

<CodeBlock language="ts">{submitReactLoginApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### More Concepts and API References

More conceptual information on the login flow can be found in [Self-service Login Flow](../kratos/self-service/flows/user-login).

For API references, please take a look at the [API Reference](../reference/api) section.

Below are the API references for the login flow.

- [Create Browser Login Flow](../reference/api#tag/frontend/operation/createBrowserLoginFlow)
- [Create Native Login Flow](../reference/api#tag/frontend/operation/createNativeLoginFlow)
- [Get Login Flow](../reference/api#tag/frontend/operation/getLoginFlow)
- [Update Login Flow](../reference/api#tag/frontend/operation/updateLoginFlow)

## Registration flow

Registration flows are used to create user identities. When the registration is successful, the request will respond with a
`200 OK` HTTP status code. When the request fails, it responds with the appropriate HTTP status and error messages.

:::note

Registration data are dependent on the [Identity Schema](../kratos/manage-identities/identity-schema) traits. This ensures
registration flows are flexible and can be used for a variety of use cases.

:::

### Create Registration flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import createRegistrationApi from '!!raw-loader!../../code-examples/sdk/go/selfservice/create-registration.go'

<CodeBlock language="go">{createRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import createTsRegistrationApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/registration/create-registration-native.ts'

<CodeBlock language="ts">{createTsRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import createReactRegistrationApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/registration/create-registration-react.tsx'

<CodeBlock language="ts">{createReactRegistrationApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Get Registration flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import getRegistrationApi from '!!raw-loader!../../code-examples/sdk/go/selfservice/get-registration.go'

<CodeBlock language="go">{getRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import getTsRegistrationApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/registration/get-registration-native.ts'

<CodeBlock language="ts">{getTsRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import getReactRegistrationApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/registration/get-registration-react.tsx'

<CodeBlock language="ts">{getReactRegistrationApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Submit Registration flow

:::note

A session cookie or token is only available after registration when enabled in the Ory configuration. More information can be
found in [Customize login and registration](../identities/sign-in/actions#log-in-users-after-registration).

:::

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import submitRegistrationApi from '!!raw-loader!../../code-examples/sdk/go/selfservice/submit-registration.go'

<CodeBlock language="go">{submitRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import submitTsRegistrationApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/registration/submit-registration-native.ts'

<CodeBlock language="ts">{submitTsRegistrationApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import submitReactRegistrationApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/registration/submit-registration-react.tsx'

<CodeBlock language="ts">{submitReactRegistrationApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### More Concepts and API References

More conceptual information on the registration flow can be found in
[Self-service Registration Flow](../kratos/self-service/flows/user-registration).

For API references, please take a look at the [API Reference](../reference/api) section.

Below are the API references for the registration flow.

- [Create Browser Registration Flow](../reference/api#tag/frontend/operation/createBrowserRegistrationFlow)
- [Create Native Registration Flow](../reference/api#tag/frontend/operation/createNativeRegistrationFlow)
- [Get Registration Flow](../reference/api#tag/frontend/operation/getRegistrationFlow)
- [Update Registration Flow](../reference/api#tag/frontend/operation/updateRegistrationFlow)

## Recovery

Recovery flows are used to recover user credentials. The recovery flow has two methods, `link` and `code` which determines how the
recovery flow is completed. The `link` method sends a recovery link and `code` sends a recovery code to the user's email address.

:::note

The `code` method is preferred to the `link` method to prevent the recovery flow from being invalidated by email clients and spam
filters.

:::

### Create Recovery flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import createRecoveryApi from '!!raw-loader!../../code-examples/sdk/go/selfservice/create-recovery.go'

<CodeBlock language="go">{createRecoveryApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import createTsRecoveryApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/recovery/create-recovery-native.ts'

<CodeBlock language="ts">{createTsRecoveryApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import createReactRecoveryApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/recovery/create-recovery-react.tsx'

<CodeBlock language="ts">{createReactRecoveryApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Get Recovery flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import getRecoveryApi from '!!raw-loader!../../code-examples/sdk/go/selfservice/get-recovery.go'

<CodeBlock language="go">{getRecoveryApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import getTsRecoveryApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/recovery/get-recovery-native.ts'

<CodeBlock language="ts">{getTsRecoveryApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import getReactRecoveryApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/recovery/get-recovery-react.tsx'

<CodeBlock language="ts">{getReactRecoveryApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Submit Recovery flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import submitRecoveryApi from '!!raw-loader!../../code-examples/sdk/go/selfservice/submit-recovery.go'

<CodeBlock language="go">{submitRecoveryApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import submitTsRecoveryApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/recovery/submit-recovery-native.ts'

<CodeBlock language="ts">{submitTsRecoveryApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import submitReactRecoveryApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/recovery/submit-recovery-react.tsx'

<CodeBlock language="ts">{submitReactRecoveryApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### More Concepts and API References

More conceptual information on the recovery flow can be found in
[Account recovery and password reset](../kratos/self-service/flows/account-recovery-password-reset).

For API references, please take a look at the [API Reference](../reference/api) section.

Below are the API references for the recovery flow.

- [Create Browser Recovery Flow](../reference/api#tag/frontend/operation/createBrowserRecoveryFlow)
- [Create Native Recovery Flow](../reference/api#tag/frontend/operation/createNativeRecoveryFlow)
- [Get Recovery Flow](../reference/api#tag/frontend/operation/getRecoveryFlow)
- [Update Recovery Flow](../reference/api#tag/frontend/operation/updateRecoveryFlow)

## Verification flow

Verification flows are used to verify user email addresses. When the verification is successful, the request will respond with a
`200 OK` HTTP status code. When the request fails, it responds with the appropriate HTTP status and error messages.

:::note

To use the verification flow, you might need to enable it. Please take a look at
[Email verification](../kratos/self-service/flows/verify-email-account-activation)

:::

### Create Verification flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import createVerificaitonApi from '!!raw-loader!../../code-examples/sdk/go/selfservice/create-verification.go'

<CodeBlock language="go">{createVerificaitonApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import createTsVerificationApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/verification/create-verification-native.ts'

<CodeBlock language="ts">{createTsVerificationApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import createReactVerificationApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/verification/create-verification-react.tsx'

<CodeBlock language="ts">{createReactVerificationApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Get Verification flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import getVerificaitonApi from '!!raw-loader!../../code-examples/sdk/go/selfservice/get-verification.go'

<CodeBlock language="go">{getVerificaitonApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import getTsVerificationApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/verification/get-verification-native.ts'

<CodeBlock language="ts">{getTsVerificationApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import getReactVerificationApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/verification/get-verification-react.tsx'

<CodeBlock language="ts">{getReactVerificationApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### Submit Verification flow

````mdx-code-block
<Tabs groupId="sdk-examples">

<TabItem value="go" label="Go" default>

```mdx-code-block
import submitVerificationApi from '!!raw-loader!../../code-examples/sdk/go/selfservice/submit-verification.go'

<CodeBlock language="go">{submitVerificationApi}</CodeBlock>
```

</TabItem>

<TabItem value="typescript" label="TypeScript">

```mdx-code-block
import submitTsVerificationApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/verification/submit-verification-native.ts'

<CodeBlock language="ts">{submitTsVerificationApi}</CodeBlock>
```

</TabItem>

<TabItem value="react" label="React">

```mdx-code-block
import submitReactVerificationApi from '!!raw-loader!../../code-examples/sdk/typescript/src/selfservice/verification/submit-verification-react.tsx'

<CodeBlock language="ts">{submitReactVerificationApi}</CodeBlock>
```

</TabItem>

</Tabs>
````

### More Concepts and API References

More conceptual information on the verification flow can be found in
[Verify email account activation](../kratos/self-service/flows/verify-email-account-activation).

For API references, please take a look at the [API Reference](../reference/api) section.

Below are the API references for the verification flow.

- [Create Browser Verification Flow](../reference/api#tag/frontend/operation/createBrowserVerificationFlow)
- [Create Native Verification Flow](../reference/api#tag/frontend/operation/createNativeVerificationFlow)
- [Get Verification Flow](../reference/api#tag/frontend/operation/getVerificationFlow)
- [Update Verification Flow](../reference/api#tag/frontend/operation/updateVerificationFlow)
