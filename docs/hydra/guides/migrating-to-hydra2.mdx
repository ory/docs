---
id: migrating-to-hydra2
title: Migrating to Hydra 2.x
---

Assumptions:

- You are performing this migration offline as opposed to on a live database
- The database is backed up

Hydra 2.x migrations require extra caution because they significantly change the
database schema, deleting some data in the process. This migration guide
features some recommendations to ensure a successful upgrade.

The queries in this guide are written in the Postgres SQL dialect.

## Sanity check queries

The query displays the numbers of consents that will be deleted by the
migration, grouped by month. Make sure that you are happy with these consents
being deleted before you continue.

We assume that only a very small number of sessions, issued by pre-1.0 Hydra,
will be affected. Please contact us if this assumption doesn't apply or if the
deletion adversely affects your deployment.

```
SELECT
  COUNT(*) AS count,
  DATE_TRUNC('month', requested_at) AS month
FROM hydra_oauth2_consent_request
WHERE login_challenge IS NULL
GROUP BY month;
```

## TODO complete this guide before the 2.x release
